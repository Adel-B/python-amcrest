#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 2 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# vim:sw=4:ts=4:et

import argcomplete
import argparse

from amcrest import AmcrestCamera


def main():
    parser = argparse.ArgumentParser(
        description='Command line interface for Amcrest cameras.',
        formatter_class=argparse.RawTextHelpFormatter
    )

    parser.add_argument('-H', '--hostname',
                        dest='hostname',
                        help='hostname or ip address for Amcrest camera')

    parser.add_argument('-u',
                        '--username',
                        dest='username',
                        help='username for Amcrest camera')

    parser.add_argument('-p',
                        '--password',
                        dest='password',
                        help='password for Amcrest camera')

    parser.add_argument('-P',
                        '--port',
                        dest='port',
                        default=80,
                        help='port to Amcrest camera. Default: 80')

    parser.add_argument('--info-user',
                        dest='info_user',
                        help='info about username')

    parser.add_argument('--info-all-users',
                        action='store_true',
                        help='info about all users')

    parser.add_argument('--info-all-active-users',
                        action='store_true',
                        help='info about all active users')

    parser.add_argument('--info-group',
                        dest='info_group',
                        help='info about group')

    parser.add_argument('--info-all-groups',
                        action='store_true',
                        help='info about all groups')

    parser.add_argument('--delete-user',
                        dest='delete_user',
                        help='delete username')

    parser.add_argument('--general-config',
                        action='store_true',
                        help='general configuration')

    parser.add_argument('--software-information',
                        action='store_true',
                        help='software information')

    parser.add_argument('--device-class',
                        action='store_true',
                        help='device class')

    parser.add_argument('--machine-name',
                        action='store_true',
                        help='machine name')

    parser.add_argument('--serial-number',
                        action='store_true',
                        help='serial number')

    parser.add_argument('--onvif-information',
                        action='store_true',
                        help='onvif information')

    parser.add_argument('--vendor-information',
                        action='store_true',
                        help='vendor information')

    parser.add_argument('--system-information',
                        action='store_true',
                        help='the system information')

    parser.add_argument('--device-type',
                        action='store_true',
                        help='device type')

    parser.add_argument('--config-backup',
                        action='store_true',
                        help='config backup')

    parser.add_argument('--hardware-version',
                        action='store_true',
                        help='hardware version')

    parser.add_argument('--audio-input-channels-numbers',
                        action='store_true',
                        help='audio input channels numbers')

    parser.add_argument('--audio-output-channels-numbers',
                        action='store_true',
                        help='audio output channels numbers')

    parser.add_argument('--snapshot',
                        dest='snapshot_option',
                        default='0',
                        nargs='?',
                        const='0',
                        help='get snapshot, use 0, 1 or 2\n'
                             '0 - regular snapshot\n'
                             '1 - motion detection snapshot\n'
                             '2 - alarm snapshot')

    parser.add_argument('--network-interfaces',
                        action='store_true',
                        help='Get network interfaces')

    parser.add_argument('--video-blind-detect-config',
                        action='store_true',
                        help='Get video blind detect config')

    parser.add_argument('--video-loss-detect-config',
                        action='store_true',
                        help='Get video loss detect config')

    parser.add_argument('--version-http-api',
                        action='store_true',
                        help='Get version of HTTP API')

    parser.add_argument('--scan-devices',
                        dest='scan_devices',
                        help='scan Amcrest cameras in the subnet provided\n'
                             'i.e: 192.168.1.0/24')

    parser.add_argument('--timeout',
                        dest='timeout',
                        type=int,
                        const=None,
                        help='set timeout for operations like\n'
                             ' scan-devices')

    parser.add_argument('--current-time',
                        nargs='?',
                        const=-1,
                        help='camera current time')

    parser.add_argument('--motion-detection',
                        nargs='?',
                        const=-1,
                        help='enable/disable motion detection (True or False)')

    parser.add_argument('--network-config',
                        nargs='?',
                        const=-1,
                        help='network configuration')

    parser.add_argument('--snapshot-config',
                        nargs='?',
                        const=-1,
                        help='get snapshot configuration')

    parser.add_argument('--output',
                        dest='output',
                        help='set output file name for operations\n'
                             ' like snapshot')

    parser.add_argument('--event-handler-config',
                        dest='event_handler_config',
                        help='get event handler configname')

    parser.add_argument('--alarm-config',
                        action='store_true',
                        help='get alarm config')

    parser.add_argument('--alarm-out-config',
                        action='store_true',
                        help='get alarm out config')

    parser.add_argument('--alarm-states-output-channels',
                        action='store_true',
                        help='alarm states output channels')

    parser.add_argument('--alarm-states-input-channels',
                        action='store_true',
                        help='alarm states input channels')

    parser.add_argument('--alarm-input-channels',
                        action='store_true',
                        help='alarm input channels')

    parser.add_argument('--alarm-output-channels',
                        action='store_true',
                        help='alarm output channels')

    parser.add_argument('--event-login-failure',
                        action='store_true',
                        help='event login failure')

    parser.add_argument('--event-storage-not-exist',
                        action='store_true',
                        help='event storage not exist')

    parser.add_argument('--event-management',
                        action='store_true',
                        help='event management')

    parser.add_argument('--event-storage-access-failure',
                        action='store_true',
                        help='event storage access failure')

    parser.add_argument('--event-storage-low-space',
                        action='store_true',
                        help='event storage low space')

    parser.add_argument('--event-net-abort',
                        action='store_true',
                        help='event net abort')

    parser.add_argument('--event-ip-conflict',
                        action='store_true',
                        help='event ip conflict')

    parser.add_argument('--event-channels-happened',
                        dest='event_channels_happened',
                        help='params: VideoMotion, VideoLoss,\n'
                             ' VideoBlind, Alarmlocal')

    parser.add_argument('--record-capability',
                        action='store_true',
                        help='show record capability')

    parser.add_argument('--record-config',
                        action='store_true',
                        help='show record config')

    parser.add_argument('--media-global-config',
                        action='store_true',
                        help='media global config')

    argcomplete.autocomplete(parser)
    args = parser.parse_args()

    amcrest = AmcrestCamera(
        args.hostname,
        args.port,
        args.username,
        args.password
    )
    camera = amcrest.camera
    if args.scan_devices:
        ret = camera.scan_devices(args.scan_devices, args.timeout)
        if ret:
            print(("Looks like amcrest device: {0}".format(ret)))
        else:
            print("No devices found, try again later!")
        return

    if args.username and args.hostname and args.password:

        if args.record_capability:
            print((camera.record_capability))
            return

        if args.record_config:
            print((camera.record_config))
            return

        if args.media_global_config:
            print((camera.media_global_config))
            return

        if args.audio_input_channels_numbers:
            print((camera.audio_input_channels_numbers))

        if args.audio_output_channels_numbers:
            print((camera.audio_output_channels_numbers))

        if args.event_storage_not_exist:
            print((camera.event_storage_not_exist))

        if args.event_login_failure:
            print((camera.event_login_failure))

        if args.event_net_abort:
            print((camera.event_net_abort))

        if args.event_ip_conflict:
            print((camera.event_ip_conflict))

        if args.event_management:
            print((camera.event_management))

        if args.event_storage_low_space:
            print((camera.event_storage_low_space))

        if args.event_storage_access_failure:
            print((camera.event_storage_access_failure))

        if args.general_config:
            print((camera.general_config))

        if args.video_blind_detect_config:
            print((camera.video_blind_detect_config))

        if args.video_loss_detect_config:
            print((camera.video_loss_detect_config))

        if args.alarm_config:
            print((camera.alarm_config))

        if args.alarm_out_config:
            print((camera.alarm_out))

        if args.alarm_output_channels:
            print((camera.alarm_output_channels))

        if args.alarm_input_channels:
            print((camera.alarm_input_channels))

        if args.alarm_states_output_channels:
            print((camera.alarm_states_output_channels))

        if args.alarm_states_input_channels:
            print((camera.alarm_states_input_channels))

        if args.event_channels_happened:
            print((camera.event_channels_happened(
                args.event_channels_happened)))

        if args.event_handler_config:
            print((camera.event_handler_config(args.event_handler_config)))

        if args.info_group:
            print((camera.info_user(args.info_group)))

        if args.info_all_groups:
            print((camera.info_all_groups))

        if args.delete_user:
            print((camera.delete_user(args.delete_user)))

        if args.info_all_users:
            print((camera.info_all_users))

        if args.info_all_active_users:
            print((camera.info_all_active_users))

        if args.info_user:
            print((camera.info_user(args.info_user)))

        elif args.device_class:
            print((camera.device_class))

        elif args.onvif_information:
            print((camera.onvif_information))

        elif args.vendor_information:
            print((camera.vendor_information))

        elif args.system_information:
            print((camera.system_information))

        elif args.machine_name:
            print((camera.machine_name))

        elif args.device_type:
            print((camera.device_type))

        elif args.serial_number:
            print((camera.serial_number))

        elif args.hardware_version:
            print((camera.hardware_version))

        elif args.version_http_api:
            print((camera.version_http_api))

        elif args.software_information:
            print((camera.software_information))

        elif args.network_config:
            print((camera.network_config))

        elif args.network_interfaces:
            print((camera.network_interfaces))

        elif args.current_time == -1:
            print((camera.current_time))

        elif args.motion_detection == -1:
            print((camera.motion_detection))

        elif args.motion_detection:
            camera.motion_detection = args.motion_detection

        elif args.current_time is not None:
            camera.current_time = args.current_time

        elif args.snapshot_config:
            print((camera.snapshot_config))

        elif args.config_backup:
            if args.output:
                camera.config_backup(args.output)
            else:
                print("This option requires --output")

        elif args.snapshot_option:
            if args.output:
                camera.snapshot(args.snapshot_option, args.output)
            else:
                print("This option requires --output")
    else:
        print('Error: You must specify a valid operation. See usage:')
        parser.print_usage()

if __name__ == '__main__':
    main()
